(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1630dc68"],{"29a2":function(t,e,a){},4432:function(t,e,a){"use strict";var s=a("29a2"),i=a.n(s);i.a},"625c":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"table"},[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-lx-cascades"}),t._v(" 心跳监测 ")])],1)],1),a("div",{staticClass:"container"},[a("div",{staticClass:"handle-box"},[a("el-input",{staticClass:"handle-input mr10",attrs:{placeholder:"筛选网关序号"},model:{value:t.select_word,callback:function(e){t.select_word=e},expression:"select_word"}}),a("el-button",{attrs:{type:"primary",icon:"search"},on:{click:t.search}},[t._v("搜索")])],1),a("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:t.currentTableData,border:""},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{prop:"id",type:"selection",width:"55",align:"center",label:"ID"}}),a("el-table-column",{attrs:{prop:"gw_id",label:"网关序列号",width:"160"}}),a("el-table-column",{attrs:{prop:"ip",label:"发送网址"}}),a("el-table-column",{attrs:{prop:"update_time",formatter:t.dateFormat,label:"更新时间"}}),a("el-table-column",{attrs:{prop:"hb_status",label:"心跳状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.hb_status?a("el-tag",{attrs:{type:"success","disable-transitions":""}},[t._v("正常")]):0==e.row.hb_status?a("el-tag",{attrs:{type:"warning","disable-transitions":""}},[t._v("失效")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"操作",width:"240",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",icon:"el-icon-star"},on:{click:function(e){t.rebootVisible=!0}}},[t._v("重启")])]}}])})],1),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{background:"","current-page":t.cur_page,"page-size":t.pageSize,layout:"prev, pager, next",total:t.totalCount},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"单元格图",visible:t.cellVisible,width:"70%"}},[t._l(t.cells,function(e){return a("div",{staticStyle:{float:"left",width:"40%",height:"50%",margin:"5px"},style:{background:1==e.status?"rgb(64, 158, 255)":"rgb(245, 108, 108)"},attrs:{accesskey:e.id}},[a("p",[t._v(t._s(e.gw_id))])])}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.cellVisible=!1}}},[t._v("取 消")])],1)],2),a("el-dialog",{attrs:{title:"提示",visible:t.rebootVisible,width:"300px",center:""},on:{"update:visible":function(e){t.rebootVisible=e}}},[a("div",{staticClass:"del-dialog-cnt"},[t._v("确认重启吗？")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.rebootVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.handleReboot}},[t._v("确 定")])],1)])],1)},i=[],l=(a("7f7f"),a("57e7"),a("ac6a"),a("f3e2"),a("4ec3"),a("c466")),r={name:"gatewayhb",data:function(){return{tableData:[],currentTableData:[],filtercurrentTableData:[],totalCount:0,pageSize:10,cur_page:1,multipleSelection:[],select_cate:"",select_word:"",del_list:[],is_search:!1,cellVisible:!1,rebootVisible:!1,cells:[],defaultProps:{children:"subs",label:"title"},configVisible:!1,delVisible:!1,form_add:{user_login:"",user_pass:"",user_email:"",user_url:"",user_type:"",role_id:""},form_config:{id:"",user_login:"",user_status:"",last_login_time:"",last_login_ip:"",role_id:""},idx:-1}},created:function(){},mounted:function(){this.hbIotlist(),setInterval(this.hbIotlist,6e4)},computed:{},methods:{dateFormat:function(t,e){var a=.001*t.update_time;return void 0==a?"":Object(l["a"])(new Date(1e3*a),"yyyy-MM-dd hh:mm")},hbIotlist:function(){var t=this;this.$api.iot.hbIotlist().then(function(e){if(200!=e.code)t.$message({message:"获取网关心跳信息失败",type:"error",center:!0,duration:1e3});else if(t.tableData=e.data.list,console.log(e.data.list),t.totalCount=t.tableData.length,t.totalCount>t.pageSize)for(var a=0;a<t.pageSize;a++)t.currentTableData.push(t.tableData[a]);else t.currentTableData=t.tableData}).catch(function(t){console.log(t)})},search:function(){var t=this;if(""!=this.select_word||1!=this.is_search)""!=this.select_word||0!=this.is_search?(this.currentTableData=[],this.filtercurrentTableData=[],this.tableData.forEach(function(e,a){e.gw_id&&e.gw_id.indexOf(t.select_word)>=0&&t.filtercurrentTableData.push(e)}),this.cur_page=1,this.totalCount=this.filtercurrentTableData.length,this.currentChangePage(this.filtercurrentTableData),this.is_search=!0):this.$message.warning("查询条件不能为空！");else if(this.is_search=!1,this.currentTableData=[],this.totalCount=this.tableData.length,this.totalCount>this.pageSize)for(var e=0;e<this.pageSize;e++)this.currentTableData.push(this.tableData[e]);else this.currentTableData=this.tableData},handleSizeChange:function(t){this.pageSize=t,this.handleCurrentChange(this.cur_page)},handleCurrentChange:function(t){console.log("当前页: ".concat(t)),this.cur_page=t,this.is_search?this.currentChangePage(this.filtercurrentTableData):this.currentChangePage(this.tableData)},currentChangePage:function(t){var e=(this.cur_page-1)*this.pageSize,a=this.cur_page*this.pageSize;for(this.currentTableData=[];e<a;e++)t[e]&&this.currentTableData.push(t[e])},handleReboot:function(){var t=this;this.$api.iot.gatewayReboot().then(function(e){200!=e.code&&t.$message.error("重启失败"),"rebooting"==e.msg?t.$message.success("正在重启中，请稍后！"):(t.rebootVisible=!1,t.$message.success("重启请求已发送，请稍后！"))})},cellShow:function(){var t=this;this.$api.iot.cellGates().then(function(e){200==e.code?(t.cells=e.data,t.cellVisible=!0):t.$message.warning("心跳单元格数据获取失败")})},delAll:function(){var t=this.multipleSelection.length,e="";this.del_list=this.del_list.concat(this.multipleSelection);for(var a=0;a<t;a++)e+=this.multipleSelection[a].name+" ";this.$message.error("删除了"+e),this.multipleSelection=[]},handleSelectionChange:function(t){this.multipleSelection=t},saveConfig:function(){var t=this;if(""!=this.form_config.user_login)if(""!=this.form_config.role_id){this.$set(this.currentTableData,this.idx,this.form_config);var e={id:this.form_config.id,user_login:this.form_config.user_login,user_status:this.form_config.user_status,user_role:this.form_config.role_id,user_type:1};this.$api.user.editUser(e).then(function(e){200!=e.code&&t.$message.error("编辑管理员失败"),t.editVisible=!1,t.$message.success("编辑管理员成功")})}else this.$message.warning("管理员必须选择角色");else this.$message.warning("管理员名称不能为空")},saveAdd:function(){var t=this;""!=this.form_add.user_login?""!=this.form_add.user_pass?""!=this.form_add.role_id?(this.form_add.user_type=1,this.$api.user.addUser(this.form_add).then(function(e){if(200!=e.code)return t.$message.error("添加管理员失败"),void(t.addVisible=!1);t.tableData.push(e.data),t.addVisible=!1,t.$message.success("添加角色成功")}).catch(function(t){console.log(t)})):this.$message.warning("管理员角色不能为空"):this.$message.warning("管理员密码不能为空"):this.$message.warning("管理员名称不能为空")}}},n=r,o=(a("4432"),a("2877")),c=Object(o["a"])(n,s,i,!1,null,null,null);c.options.__file="Gatewayhb.vue";e["default"]=c.exports},c466:function(t,e,a){"use strict";a.d(e,"a",function(){return s});a("3b2b"),a("a481");function s(t,e){/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));var a={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds()};for(var s in a)if(new RegExp("(".concat(s,")")).test(e)){var l=a[s]+"";e=e.replace(RegExp.$1,1===RegExp.$1.length?l:i(l))}return e}function i(t){return("00"+t).substr(t.length)}}}]);