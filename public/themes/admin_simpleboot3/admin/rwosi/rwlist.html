<include file="public@header" />
</head>
<body>
	<div class="wrap js-check-wrap">
		<ul class="nav nav-tabs">
			<li class="active"><a href="{:url('rwosi/rwlist')}">任务管理</a></li>
			<!--<li><a href="{:url('xmosi/xmadd')}">添加项目</a></li>-->
		</ul>
		<form class="well form-inline margin-top-20" method="post" action="{:url('rwosi/rwlist')}">
			搜索条件:
			<input type="text" class="form-control" name="rwstr" value="{$data_gw_id}" style="width: 150px;" placeholder="搜索条件">
			<input type="submit" id="search" class="btn btn-primary" value="搜索"/>
			<a class="btn btn-danger" href="{:url('rwosi/rwlist')}">清空</a>
			<input type="button" id="search1" class="btn btn-primary" value="今日任务" onclick="tosubmit();"/>
		</form>
		<form class="" id="jrform" method="post" action="{:url('rwosi/rwlist')}">
			<input type="hidden" name="jrrw" value="1" >
		</form>
		<form action="{:url('Rbac/listorders')}" method="post" class="margin-top-20">
			<table class="table table-hover table-bordered">
				<thead>
					<tr>
						<th width="20">ID</th>
						<th align="left">任务名称</th>
						<th align="left">任务责任人</th>
						<th  align="left">计划方案名称</th>
						<th align="left">{:lang('ACTIONS')}</th>
					</tr>
				</thead>
				<tbody>
					<foreach name="data" item="vo">
					<tr>
						<td>{$vo.id}</td>
						<td>{$vo.taskname}</td>
						<td>{$vo.taskcharge1}</td>
						<td>{$vo.planname}</td>
						<td>
							<notempty name="$jrrwbutton">
								<!--<a class="btn btn-xs btn-primary" target="_blank" href="https://192.168.1.111:81/videocall.html">视频通话</a>-->
								<a class="btn btn-xs btn-primary" onclick='spth("{$vo.taskcharge}")'>视频通话</a>
								</notempty>
								<a class="btn btn-xs btn-primary" href="{:url('rwosi/rwinfo',array('id'=>$vo['id']))}">详情</a>
								<a class="btn btn-xs btn-danger js-ajax-delete" class="" href="{:url('rwosi/rwdel',array('id'=>$vo['id']))}">{:lang('DELETE')}</a>
						</td>
					</tr>
					</foreach>
				</tbody>
			</table>
			<div class="footer">
				<div class="pagination">{$page|default=''}</div>
			</div>
		</form>
	</div>
	<script src="__STATIC__/js/admin.js"></script>
	<script src="__STATIC__/js/layer/layer.js"></script>
<script>
function tosubmit(){
	$("#jrform").submit();
}
function spth(i){
	$.ajax({
		url: "{:url('rwosi/tocall')}",
		type: 'post',
		async: false,
		dataType:'html',
		data: 'uid='+i,
		success: function (data) {
//			if(data){
				window.open('https://192.168.1.111:81/videocallTest.html?isCall=1&mId=11&callId'+data,'','width=800,height=600,location=no,toolbar=no,titlebar=no,menubar=no, status=no,top=200,left=300');
//			}else{
//				alert("网络错误");
//			}

		}});
}
$(function(){
	$("#spth").bind('click',function(){
		$.ajax({
			url: "{:url('rwosi/tocall')}",
			type: 'post',
			async: false,
			dataType:'html',
			data: '',
			success: function (data) {
				if(data==1){
					window.open('https://192.168.1.111:81/videocallTest.html?isCall=2&mId=11&callId=2','','width=800,height=600,location=no,toolbar=no,titlebar=no,menubar=no, status=no,top=200,left=300');
				}else{
					alert("网络错误");
				}

		}});
//		layer.open({
//			type: 2,
//			title: '视频对话',
//			shadeClose: true,
//			shade: 0.8,
//			area: ['480px', '90%'],
////			content: '<iframe name="IF0" id="IF0" class="IF0" src="https://192.168.1.111:81/videocallTest.html?isCall=1&mId=11&callId=2" width="100%" height="800" scrolling="no" frameborder="no" allowtransparency="yes" security="restricted" sandbox="allow-top-navigation allow-same-origin allow-forms allow-popups allow-scripts"></iframe>'
//			content: 'https://192.168.1.111:81/videocallTest.html?isCall=1&mId=11&callId=2' //iframe的url
//		});
	});
	window.setInterval(function () {
		$.ajax({
			url: "{:url('rwosi/listion')}",
			type: 'post',
			async: false,
			dataType:'html',
			data: '',
			success: function (data) {
				if(data!='2') {
					if ($(".layui-layer-content").length <= 0) {
						layer.confirm('您有新的视频通话是否接听?', {
							btn: ['接听', '拒绝'] //按钮
						}, function () {
							toajax(data);//mid暂时写死1,正常为登录id,此处callid无所谓     192.168.1.111:8800
							window.open('https://192.168.1.111:81/videocallTest.html?isCall=0&mId=1&callId=2', '', 'width=800,height=600,top=200,left=300');
							layer.close(layer.index);
						}, function () {
							toajax(data);
							layer.close(layer.index);
						});


					}
				}
			}

		});


	},2000);
	function toajax(id){
		$.ajax({
			url: "{:url('rwosi/updatelistion')}",
			type: 'post',
			async: false,
			dataType:'html',
			data: 'id='+id,
			success: function (data) {


			}

		});
	}
})
</script>
</body>
</html>